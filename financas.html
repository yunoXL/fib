<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow - Central</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #1e293b;
            --tag-bg: #e2e8f0;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; }

        /* --- BARRA LATERAL DE METAS (ADICIONADO) --- */
        .goals-sidebar { 
            width: 80px; 
            background: var(--card); 
            border-left: 1px solid #ddd; 
            height: 100vh; 
            position: fixed; 
            right: 0; 
            top: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px 0; 
            cursor: pointer;
            transition: 0.3s;
            z-index: 100;
        }
        .goals-sidebar:hover { background: #f8fafc; width: 90px; }
        .progress-container { width: 30px; height: 70%; background: #e2e8f0; border-radius: 20px; position: relative; overflow: hidden; margin-top: 20px; }
        .progress-fill { position: absolute; bottom: 0; width: 100%; background: linear-gradient(to top, var(--success), #4ade80); transition: height 0.5s ease; }
        .goal-label { writing-mode: vertical-rl; transform: rotate(180deg); margin-top: 20px; font-weight: bold; color: var(--text); font-size: 0.8rem; }

        /* --- LAYOUT PRINCIPAL --- */
        main { flex: 1; margin-right: 80px; width: 100%; }

        #finance-app, #vault-page, #goals-page { padding: 20px; animation: fadeIn 0.3s ease; }
        header { text-align: center; padding: 20px 0; }
        .clickable-title { color: var(--primary); cursor: pointer; font-size: 2.5rem; font-weight: 900; margin: 0; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .months-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; max-width: 1100px; margin: 40px auto 20px; }
        .month-card { background: var(--card); padding: 45px 15px; border-radius: 25px; text-align: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.3s; font-weight: 700; font-size: 1.2rem; }
        .month-card:hover { transform: scale(1.05); background: var(--primary); color: white; }

        .bottom-sections { max-width: 1100px; margin: 0 auto 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .info-box { background: var(--card); padding: 30px; border-radius: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .vault-card-access { background: linear-gradient(135deg, var(--warning), #d97706); color: white; cursor: pointer; transition: 0.3s; }

        /* --- METAS CARDS --- */
        .goals-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px; }
        .goal-card { background: var(--card); padding: 25px; border-radius: 25px; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 2px solid transparent; }
        .goal-card.favorite { border-color: var(--warning); }
        .star-btn { position: absolute; top: 15px; right: 15px; cursor: pointer; font-size: 1.5rem; }

        /* ESTILOS ORIGINAIS MANTIDOS */
        .limit-input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .limit-input-group input { flex: 1; padding: 10px; border-radius: 10px; border: 1px solid #ddd; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid #ddd; box-sizing: border-box; }
        .add-btn { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; padding: 12px; border-radius: 12px; }
        #month-detail, .vault-content { display: none; max-width: 1000px; margin: 0 auto; }
        .layout-grid { display: grid; grid-template-columns: 1fr 1.2fr; gap: 30px; }
        .card { background: var(--card); padding: 20px; border-radius: 20px; text-align: center; }
        .card.in { color: var(--success); } .card.out { color: var(--danger); } .card.balance { background: var(--primary); color: white; }
        .transaction-item { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 15px; margin-bottom: 10px; border-radius: 15px; border-left: 6px solid #ddd; }
        .btn-del { background: #fee2e2; color: var(--danger); border: none; padding: 8px 12px; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="goals-sidebar" onclick="goToGoals()">
        <span id="side-goal-percent" style="font-weight: 900; color: var(--success);">0%</span>
        <div class="progress-container"><div id="side-progress-fill" class="progress-fill" style="height: 0%;"></div></div>
        <div id="side-goal-name" class="goal-label">Nenhuma Meta</div>
    </div>

    <main>
        <div id="finance-app">
            <header><h1 class="clickable-title" onclick="window.location.href='index.html'">Flow Finan√ßas</h1></header>

            <div id="finance-home">
                <div class="months-grid" id="months-grid"></div>
                <div class="bottom-sections">
                    <div class="info-box">
                        <h3 style="color: var(--primary); margin-top:0;">üí≥ Cart√£o de Cr√©dito</h3>
                        <div class="limit-input-group">
                            <input type="number" id="card-limit-input" placeholder="Limite Total (R$)">
                            <button class="add-btn" style="width: auto; margin: 0; padding: 0 20px;" onclick="saveLimit()">Salvar</button>
                        </div>
                        <p>Dispon√≠vel: <b id="avail-limit-text" style="color: var(--success);">R$ 0,00</b></p>
                        <p>Fatura: <b id="current-bill-text" style="color: var(--danger);">R$ 0,00</b></p>
                        <div style="height: 150px;"><canvas id="limitChart"></canvas></div>
                    </div>
                    <div class="info-box vault-card-access" onclick="goToVault()">
                        <h3 style="margin-top:0;">üîí Meu Cofre</h3>
                        <p>Patrim√¥nio Total:</p>
                        <h2 id="total-vault-display">R$ 0,00</h2>
                        <p style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 10px; text-align: center;">Ver Investimentos ‚Üí</p>
                    </div>
                </div>
            </div>

            <div id="goals-page" style="display:none;">
                <button onclick="backToFinanceHome()" style="background:none; border:none; color:var(--primary); cursor:pointer; font-weight:bold; margin-bottom:20px;">‚Üê Voltar</button>
                <h2 style="color: var(--primary)">üéØ Gest√£o de Metas</h2>
                <div class="goals-grid" id="goals-list"></div>
            </div>

            <div id="month-detail">
                <button onclick="backToFinanceHome()" style="background:none; border:none; color:var(--primary); cursor:pointer; font-weight:bold; margin-bottom:20px;">‚Üê Voltar</button>
                <h2 id="current-month-title">M√™s</h2>
                <div class="summary-cards" style="display: grid; grid-template-columns: repeat(3,1fr); gap:15px; margin-bottom: 20px;">
                    <div class="card in"><b>Entradas</b><div id="total-in">R$ 0,00</div></div>
                    <div class="card out"><b>Gastos</b><div id="total-out">R$ 0,00</div></div>
                    <div class="card balance"><b>Saldo</b><div id="total-balance">R$ 0,00</div></div>
                </div>
                <div class="layout-grid">
                    <div class="left-col">
                        <div class="info-box">
                            <h3>Novo Registro</h3>
                            <input type="text" id="desc" placeholder="Descri√ß√£o">
                            <input type="number" id="val" placeholder="Valor total R$">
                            <select id="cat" onchange="toggleInstallments()">
                                <option value="Outros">Outros</option>
                                <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
                                <option value="Investimento">Investimento</option>
                                <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                                <option value="Sal√°rio">Sal√°rio</option>
                            </select>
                            <div id="installments-div" style="display:none;">
                                <input type="number" id="inst-count" value="1" min="1" max="12">
                            </div>
                            <select id="type"><option value="out">Gasto (-)</option><option value="in">Entrada (+)</option></select>
                            <button class="add-btn" style="width:100%" onclick="addTransaction()">Adicionar</button>
                        </div>
                        <div style="height: 250px;"><canvas id="financeChart"></canvas></div>
                    </div>
                    <div class="right-col"><h3>Hist√≥rico</h3><div id="transaction-list"></div></div>
                </div>
            </div>
        </div>

        <div id="vault-page" style="display: none;">
            <header><h1 class="clickable-title" onclick="backToFinanceHome()">Flow Patrim√¥nio</h1></header>
            <div class="vault-content" style="display: block; padding: 20px;">
                <button onclick="backToFinanceHome()" style="background:none; border:none; color:var(--primary); cursor:pointer; font-weight:bold; margin-bottom:20px;">‚Üê Voltar</button>
                <div class="layout-grid">
                    <div class="info-box">
                        <h3 style="color: var(--warning)">Novo Ativo</h3>
                        <input type="text" id="inv-name" placeholder="Ativo">
                        <input type="number" id="inv-price" placeholder="Pre√ßo">
                        <input type="number" id="inv-qty" placeholder="Qtd">
                        <select id="inv-type">
                            <option value="Renda Fixa">Renda Fixa</option>
                            <option value="Renda Vari√°vel">Renda Vari√°vel</option>
                            <option value="Cripto">Cripto</option>
                        </select>
                        <button class="add-btn" style="background: var(--warning); width: 100%;" onclick="addInvestment()">Salvar</button>
                        <div style="height: 250px; margin-top: 20px;"><canvas id="vaultChart"></canvas></div>
                    </div>
                    <div id="invest-list"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- SEU BANCO DE DADOS ORIGINAL ---
        const months = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        let db = JSON.parse(localStorage.getItem('flow_db')) || {};
        let investments = JSON.parse(localStorage.getItem('flow_inv')) || [];
        let cardLimit = parseFloat(localStorage.getItem('flow_limit')) || 0;
        let currentMonth = "";
        let charts = {};

        // --- L√ìGICA DE METAS (NOVO) ---
        let goals = JSON.parse(localStorage.getItem('flow_goals')) || [
            { id: 1, name: "Meta 1", desc: "Descri√ß√£o aqui", target: 1000, current: 0, fav: true },
            { id: 2, name: "Meta 2", desc: "Descri√ß√£o aqui", target: 1000, current: 0, fav: false },
            { id: 3, name: "Meta 3", desc: "Descri√ß√£o aqui", target: 1000, current: 0, fav: false },
            { id: 4, name: "Meta 4", desc: "Descri√ß√£o aqui", target: 1000, current: 0, fav: false }
        ];

        function goToGoals() {
            document.getElementById('finance-home').style.display = 'none';
            document.getElementById('goals-page').style.display = 'block';
            renderGoals();
        }

        function renderGoals() {
            const list = document.getElementById('goals-list'); list.innerHTML = '';
            goals.forEach(g => {
                const percent = Math.min((g.current / g.target) * 100, 100).toFixed(0);
                list.innerHTML += `<div class="goal-card ${g.fav ? 'favorite' : ''}">
                    <span class="star-btn" onclick="setFavGoal(${g.id})">${g.fav ? '‚≠ê' : '‚òÜ'}</span>
                    <input type="text" value="${g.name}" onchange="updateGoal(${g.id}, 'name', this.value)" style="font-weight:bold; border:none; background:none; padding:0;">
                    <input type="text" value="${g.desc}" onchange="updateGoal(${g.id}, 'desc', this.value)" style="font-size:0.8rem; border:none; background:none; padding:0; color:#666;">
                    <div style="margin:10px 0;">
                        <small>Meta: R$</small> <input type="number" value="${g.target}" onchange="updateGoal(${g.id}, 'target', this.value)" style="width:80px; padding:2px;">
                        <br><small>Atual: R$</small> <input type="number" value="${g.current}" onchange="updateGoal(${g.id}, 'current', this.value)" style="width:80px; padding:2px;">
                    </div>
                    <div style="background:#eee; height:8px; border-radius:4px;"><div style="background:var(--success); width:${percent}%; height:100%; border-radius:4px;"></div></div>
                    <small>Falta: R$ ${(g.target - g.current).toFixed(2)}</small>
                </div>`;
            });
            updateSidebar();
        }

        function updateGoal(id, field, val) {
            const goal = goals.find(g => g.id === id);
            goal[field] = field === 'name' || field === 'desc' ? val : parseFloat(val) || 0;
            localStorage.setItem('flow_goals', JSON.stringify(goals));
            updateSidebar();
        }

        function setFavGoal(id) {
            goals.forEach(g => g.fav = (g.id === id));
            localStorage.setItem('flow_goals', JSON.stringify(goals));
            renderGoals();
        }

        function updateSidebar() {
            const fav = goals.find(g => g.fav) || goals[0];
            const percent = Math.min((fav.current / fav.target) * 100, 100).toFixed(0);
            document.getElementById('side-goal-percent').innerText = percent + '%';
            document.getElementById('side-progress-fill').style.height = percent + '%';
            document.getElementById('side-goal-name').innerText = `${fav.name} (Falta R$ ${(fav.target - fav.current).toFixed(2)})`;
        }

        // --- TODAS AS SUAS FUN√á√ïES ORIGINAIS ABAIXO (SEM ALTERA√á√ÉO) ---
        function goToVault() { document.getElementById('finance-app').style.display='none'; document.getElementById('vault-page').style.display='block'; renderInvestments(); }
        function backToFinanceHome() { document.getElementById('finance-app').style.display='block'; document.getElementById('finance-home').style.display='block'; document.getElementById('month-detail').style.display='none'; document.getElementById('vault-page').style.display='none'; document.getElementById('goals-page').style.display='none'; updateLimitDashboard(); updateVaultDisplay(); }
        function toggleInstallments() { document.getElementById('installments-div').style.display = (document.getElementById('cat').value === 'Cart√£o de Cr√©dito') ? 'block' : 'none'; }
        function saveLimit() { cardLimit = parseFloat(document.getElementById('card-limit-input').value) || 0; localStorage.setItem('flow_limit', cardLimit); updateLimitDashboard(); }
        
        function updateLimitDashboard() {
            let spent = 0;
            Object.values(db).flat().forEach(t => { if(t.cat === 'Cart√£o de Cr√©dito' && t.type === 'out') spent += t.val; });
            document.getElementById('avail-limit-text').innerText = `R$ ${(cardLimit - spent).toFixed(2)}`;
            document.getElementById('current-bill-text').innerText = `R$ ${spent.toFixed(2)}`;
            updateChart('limitChart', ['Livre', 'Usado'], [Math.max(0, cardLimit-spent), spent], ['#22c55e', '#6366f1']);
        }

        function addTransaction() {
            const desc = document.getElementById('desc').value, val = parseFloat(document.getElementById('val').value);
            const cat = document.getElementById('cat').value, type = document.getElementById('type').value;
            const inst = parseInt(document.getElementById('inst-count').value) || 1;
            if(!desc || !val) return;
            if(cat === 'Cart√£o de Cr√©dito' && inst > 1) {
                for(let i=0; i < inst; i++) {
                    let target = months[(months.indexOf(currentMonth) + i) % 12];
                    if(!db[target]) db[target] = [];
                    db[target].push({ id: Date.now()+i, desc: `${desc} (${i+1}/${inst})`, val: val/inst, cat, type });
                }
            } else {
                if(!db[currentMonth]) db[currentMonth] = [];
                db[currentMonth].push({ id: Date.now(), desc, val, cat, type });
            }
            localStorage.setItem('flow_db', JSON.stringify(db));
            renderTransactions();
        }

        function renderMonths() {
            const grid = document.getElementById('months-grid'); grid.innerHTML = '';
            months.forEach(m => {
                const div = document.createElement('div'); div.className = 'month-card'; div.innerText = m;
                div.onclick = () => { currentMonth = m; document.getElementById('finance-home').style.display='none'; document.getElementById('month-detail').style.display='block'; document.getElementById('current-month-title').innerText=m; renderTransactions(); };
                grid.appendChild(div);
            });
        }

        function renderTransactions() {
            const list = document.getElementById('transaction-list'); list.innerHTML = '';
            let tin = 0, tout = 0;
            (db[currentMonth] || []).forEach(t => {
                list.innerHTML += `<div class="transaction-item" style="border-left-color:${t.type==='in'?'var(--success)':'var(--danger)'}">
                    <div><b>${t.desc}</b><br><span>${t.cat}</span></div>
                    <div>R$ ${t.val.toFixed(2)} <button class="btn-del" onclick="deleteTransaction(${t.id})">X</button></div></div>`;
                t.type === 'in' ? tin += t.val : tout += t.val;
            });
            document.getElementById('total-in').innerText = `R$ ${tin.toFixed(2)}`;
            document.getElementById('total-out').innerText = `R$ ${tout.toFixed(2)}`;
            document.getElementById('total-balance').innerText = `R$ ${(tin-tout).toFixed(2)}`;
            updateChart('financeChart', ['Saldo', 'Gastos'], [Math.max(0, tin-tout), tout], ['#22c55e', '#ef4444']);
        }

        function deleteTransaction(id) {
            db[currentMonth] = db[currentMonth].filter(t => t.id !== id);
            localStorage.setItem('flow_db', JSON.stringify(db));
            renderTransactions();
        }

        function addInvestment() {
            const name = document.getElementById('inv-name').value, price = parseFloat(document.getElementById('inv-price').value);
            const qty = parseFloat(document.getElementById('inv-qty').value), type = document.getElementById('inv-type').value;
            if(!name || isNaN(price)) return;
            investments.push({ id: Date.now(), name, price, qty, val: price * qty, type });
            localStorage.setItem('flow_inv', JSON.stringify(investments));
            renderInvestments();
        }

        function renderInvestments() {
            const list = document.getElementById('invest-list'); list.innerHTML = '';
            let types = {};
            investments.forEach(inv => {
                list.innerHTML += `<div class="transaction-item" style="border-left-color:var(--warning)">
                    <div><b>${inv.name}</b><br><small>${inv.qty} cotas</small></div>
                    <div>R$ ${inv.val.toFixed(2)} <button class="btn-del" onclick="deleteInvestment(${inv.id})">X</button></div></div>`;
                types[inv.type] = (types[inv.type] || 0) + inv.val;
            });
            updateChart('vaultChart', Object.keys(types), Object.values(types), ['#f59e0b', '#3b82f6', '#10b981']);
            updateVaultDisplay();
        }

        function deleteInvestment(id) { investments = investments.filter(i => i.id !== id); localStorage.setItem('flow_inv', JSON.stringify(investments)); renderInvestments(); }
        function updateVaultDisplay() { let total = investments.reduce((acc, i) => acc + i.val, 0); document.getElementById('total-vault-display').innerText = `R$ ${total.toFixed(2)}`; }

        function updateChart(id, labels, data, colors) {
            const ctx = document.getElementById(id).getContext('2d');
            if(charts[id]) charts[id].destroy();
            charts[id] = new Chart(ctx, { type: 'doughnut', data: { labels, datasets: [{ data, backgroundColor: colors, borderWidth: 0 }] }, options: { maintainAspectRatio: false }});
        }

        window.onload = () => { renderMonths(); updateLimitDashboard(); updateVaultDisplay(); updateSidebar(); };
    </script>
</body>
</html>